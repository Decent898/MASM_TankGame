# 坦克大战 - RETRO TANK BATTLE

一个使用 MASM32 汇编语言开发的双人坦克对战游戏，带有 Undertale 风格的街机菜单界面。

## 🎮 游戏特性

- ✨ **Undertale 风格菜单** - 经典街机风格的主菜单和暂停菜单
- 🎯 **双人对战** - 支持两位玩家同时对战
- 🔄 **暂停与重开** - 游戏中可随时暂停或重新开始
- 🧱 **智能地图生成** - 随机生成墙壁布局，并保证双方坦克可达
- 💥 **弹跳子弹** - 子弹可以从墙壁反弹最多 7 次
- 🎨 **双缓冲渲染** - 流畅的游戏画面
- 🔄 **精确旋转碰撞** - OBB碰撞检测，考虑坦克旋转角度

## 📁 项目结构

```
MASM/
├── TankGame.asm      # 主程序入口和窗口处理
├── constants.inc     # 常量定义（窗口、游戏参数等）
├── data.inc          # 数据定义（变量、字符串等）
├── gamelogic.asm     # 游戏核心逻辑（移动、碰撞、射击）
├── menu.asm          # 菜单系统（主菜单、暂停菜单）
├── render.asm        # 渲染模块（绘制坦克、地图、UI）
└── Tank.asm          # 原始代码（已弃用）
```

## 🎯 操作说明

### 玩家 1
- **W/A/S/D** - 前进/左转/后退/右转
- **J** - 发射子弹

### 玩家 2
- **↑/←/↓/→** - 前进/左转/后退/右转
- **Enter** - 发射子弹

### 游戏控制
- **P** - 暂停游戏
- **↑/↓** - 菜单选择
- **Enter** - 确认选择

## 🔧 编译与运行

### 环境要求
- MASM32 SDK
- Windows 操作系统
- Visual Studio（可选）

### 使用 MASM32 编译
```batch
cd MASM
ml /c /coff TankGame.asm
link /subsystem:windows TankGame.obj
```

### 使用 Visual Studio
1. 打开 `MASM.sln`
2. 确保项目设置为编译 `TankGame.asm`
3. 按 F5 运行

## 🎨 游戏状态

游戏包含 4 个主要状态：

1. **STATE_MENU** (0) - 主菜单
   - START GAME - 开始游戏
   - QUIT - 退出游戏

2. **STATE_PLAYING** (1) - 游戏进行中
   - 按 P 键暂停

3. **STATE_PAUSED** (2) - 游戏暂停
   - RESUME - 继续游戏
   - RESTART - 重新开始
   - QUIT TO MENU - 返回主菜单

4. **STATE_GAME_OVER** (3) - 游戏结束
   - 显示获胜玩家
   - 按 Enter 返回主菜单

## 🎯 游戏规则

- 每个坦克可以发射子弹攻击对手
- 子弹会从墙壁反弹，最多反弹 7 次
- 被子弹击中的玩家失败
- 坦克无法穿越墙壁（考虑旋转后的实际占用空间）
- 发射子弹后有冷却时间
- 每局游戏生成的地图保证双方可以到达对方

## 🎨 配色方案

- **玩家 1** - 橙色 (0x00A0FF)
- **玩家 2** - 红色 (0xFF4040)
- **子弹** - 黄色 (0x00FFFF)
- **墙壁** - 灰色 (0x969696)
- **菜单高亮** - 金色 (0xFFD700)

## 📝 技术细节

### 核心技术
- **固定点数运算** - 使用 256 倍放大的整数进行精确位置计算
- **三角函数查找表** - 预计算 360 度的 sin/cos 值
- **OBB 碰撞检测** - 旋转包围盒碰撞检测，根据坦克角度计算四个实际角点位置
- **双缓冲** - 使用内存 DC 实现无闪烁渲染

### 地图系统
- 20×15 的格子地图
- 每个格子 40×40 像素
- 随机生成墙壁（20% 概率）
- **BFS 连通性检测** - 自动检测地图连通性，确保双方坦克可以相遇
- 保证玩家起始位置无墙壁

## 🚀 未来改进

- [ ] 添加音效
- [ ] 增加更多武器类型
- [ ] 实现 AI 对手
- [ ] 添加计分系统
- [ ] 支持更多地图模式
- [ ] 添加道具系统

## 📄 许可证

本项目仅供学习交流使用。

## 👨‍💻 开发信息

- **语言**: MASM32 Assembly
- **平台**: Windows
- **框架**: Win32 API
- **风格**: Undertale-inspired Arcade

---

**享受游戏！** 🎮
